<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlfaCRM Phone Format Checker</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        pre {
            background: #252526;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #3e3e42;
        }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #1177bb;
        }
        .loading {
            color: #4ec9b0;
        }
        .error {
            color: #f48771;
        }
        .success {
            color: #4ec9b0;
        }
        .phone-example {
            background: #2d2d30;
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid #4ec9b0;
        }
        h1 {
            color: #4ec9b0;
        }
        h2 {
            color: #569cd6;
        }
    </style>
</head>
<body>
    <h1>AlfaCRM Phone Format Checker</h1>
    <button onclick="fetchStudents()">Fetch Students from API</button>
    <div id="status"></div>
    <div id="results"></div>

    <script>
        async function fetchStudents() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            statusDiv.innerHTML = '<p class="loading">Fetching data from AlfaCRM API...</p>';
            resultsDiv.innerHTML = '';
            
            try {
                const response = await fetch('https://functions.poehali.dev/7a191c3e-5c96-4e00-b7c4-bb0f62c9fdc2?type=students');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                statusDiv.innerHTML = `<p class="success">Success! Total students: ${data.total}</p>`;
                
                // Get first 3 students with phone numbers
                const studentsWithPhone = data.students.filter(s => s.phone).slice(0, 3);
                
                if (studentsWithPhone.length === 0) {
                    resultsDiv.innerHTML = '<p class="error">No students with phone numbers found!</p>';
                    return;
                }
                
                let html = '<h2>Phone Number Format Examples:</h2>';
                
                studentsWithPhone.forEach((student, index) => {
                    const phoneStr = student.phone;
                    const phoneType = typeof phoneStr;
                    const phoneLength = phoneStr ? phoneStr.length : 0;
                    
                    // Analyze format
                    const hasPlus = phoneStr ? phoneStr.includes('+') : false;
                    const hasSpaces = phoneStr ? phoneStr.includes(' ') : false;
                    const hasDashes = phoneStr ? phoneStr.includes('-') : false;
                    const hasParentheses = phoneStr ? (phoneStr.includes('(') || phoneStr.includes(')')) : false;
                    const digitsOnly = phoneStr ? phoneStr.replace(/\D/g, '') : '';
                    
                    html += `
                        <div class="phone-example">
                            <h3>Student ${index + 1}: ${student.name || 'N/A'}</h3>
                            <p><strong>Phone (raw):</strong> "${phoneStr}"</p>
                            <p><strong>Type:</strong> ${phoneType}</p>
                            <p><strong>Length:</strong> ${phoneLength} characters</p>
                            <p><strong>Format Analysis:</strong></p>
                            <ul>
                                <li>Has '+' prefix: ${hasPlus ? '✓ YES' : '✗ NO'}</li>
                                <li>Has spaces: ${hasSpaces ? '✓ YES' : '✗ NO'}</li>
                                <li>Has dashes (-): ${hasDashes ? '✓ YES' : '✗ NO'}</li>
                                <li>Has parentheses: ${hasParentheses ? '✓ YES' : '✗ NO'}</li>
                                <li>Digits only: ${digitsOnly}</li>
                                <li>Digit count: ${digitsOnly.length}</li>
                            </ul>
                        </div>
                    `;
                });
                
                // Show full raw data
                html += '<h2>Full API Response (first 3 students):</h2>';
                html += '<pre>' + JSON.stringify(studentsWithPhone, null, 2) + '</pre>';
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">Error: ${error.message}</p>`;
                console.error('Fetch error:', error);
            }
        }
    </script>
</body>
</html>
